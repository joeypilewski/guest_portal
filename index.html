<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opening your Uber voucher…</title>
  <style>
    html,body{height:100%;margin:0}
    body{display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;text-align:center;padding:0 1rem}
    h1{font-size:1.5rem;font-weight:700;margin-bottom:1rem}
    a.btn{display:inline-block;margin-top:1rem;padding:12px 20px;border-radius:6px;font-weight:600;text-decoration:none;background:#0F7CFF;color:#fff}
  </style>
</head>
<body>
  <h1>Opening your Uber voucher…</h1>
  <noscript>
    <p>This page needs JavaScript to redirect. Please tap the button below.</p>
  </noscript>
  <a class="btn" id="fallbackLink" href="https://m.uber.com/ul/?action=applyPromo&promo=RBSZYDNZRME">Tap here if Uber doesn’t open</a>

  <script>
    /**
     * iOS captive-portal WebSheet blocks custom schemes unless there is
     * user interaction. First try the Universal Link (HTTPS) which is allowed
     * even inside the sheet. If that fails (old Android or app not installed),
     * fall back to the custom scheme after a few seconds – but only if the
     * browser is still on this page.
     */
    (function(){
      if (window.__voucherRedirectRan) return; // idempotent guard
      window.__voucherRedirectRan = true;

      const promoCode      = "RBSZYDNZRME";
      const universalLink  = `https://m.uber.com/ul/?action=applyPromo&promo=${promoCode}`;
      const deepLink       = `uber://?action=applyPromo&promo=${promoCode}`;

      // Attempt the Universal Link first – allowed inside iOS CNA & Android.
      window.location.replace(universalLink);

      // Fallback after 4 s: if we’re still visible, try the custom scheme.
      setTimeout(() => {
        if (document.visibilityState !== 'hidden') {
          window.location.href = deepLink;
        }
      }, 4000);
    })();
  </script>
</body>
</html>